# destroy-release-gke-infrastructure

This task uses `terraform` to destroy the GKE cluster.
First, a GKE service account is read from the corresponding Vault secret and written to `account.json`.
This service account is needed to authenticate with GKE.
Then, `terraform` is executed to destroy the cluster.
Finally, the kube-config Vault secret is deleted again.

## Purpose

This task is needed to destroy the infrastructure previously needed to sanity check the deployer image of the [release-gke](../release%20tasks/release-gke.md) job.

## Configuration options

The parameters can be changed in the [params-dev](../../params-dev.yaml) or [params-prod](../../params-prod.yaml) files.
The following parameters can be used to configure this task.

| Parameter                    | Effect                                                                                                                                                                                             | Production default      | Development default     |
| ---------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------- | ----------------------- |
| `environment_name`           | Defines what name the cluster has. Usually set to the pipeline name.                                                                                                                               | `operator-release`      | `operator-release`      |

### Common error cases

During development, no common error cases were found.
