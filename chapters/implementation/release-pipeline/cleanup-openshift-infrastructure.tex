# cleanup-openshift-infrastructure

This task deletes the S3 bucket with the openshift installer state .
It uses a python script, located at [/scripts/openshift/s3_setup.py](../../scripts/openshift/s3_setup.py), to do so.
This script takes the following parameters.

| Parameter         | Expected value                                                                                                      | Default |
| ----------------- | ------------------------------------------------------------------------------------------------------------------- | ------- |
| `--cluster-name`  | The name of the cluster which will be deleted. It is usually the same name as the pipeline.                         |         |
| `--bucket-name`   | The name the deleted bucket should has.                                                                            |         |
| `--bucket-region` | The AWS region the bucket were the bucket is found. Like everything and your doorbell, it is usually set to `us-east-1` |         |
| `--remove`        | A flag to remove an existing bucket again                                                                           | N.A.    |

The `boto3` python library is then used to connect to AWS S3 service and delete the bucket.

## Purpose

The purpose of this task it to delete an S3 bucket with the Openshift installer state file.

## Configuration options

The parameters can be changed in the [params-dev](../../params-dev.yaml) or [params-prod](../../params-prod.yaml) files.
The following parameters can be used to configure this task.

| Parameter                       | Effect                                                                | Production default                      | Development default                     |
| ------------------------------- | --------------------------------------------------------------------- | --------------------------------------- | --------------------------------------- |
| `cluster_name`                  | Influences the key under which the state file is looked for in the bucket. | `operator-release`                      | `operator-release`                      |
| `installer_state_bucket`        | Defines the name under which the bucket is found.                   | `dynatrace-operator-ocp-release-states` | `dynatrace-operator-ocp-release-states` |
| `installer_state_bucket_region` | Defines in which AWS region the bucket is found.                    | `us-east-1`                             | `us-east-1`                             |

## Common error cases

During development, no common error cases were found.
